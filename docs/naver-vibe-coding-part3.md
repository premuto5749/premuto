# 반려견을 위한 바이브 코딩 - 3편: 일주일 만에 50개 커밋, AI와 함께한 폭풍 개발기

> 시리즈: 반려견을 위한 바이브 코딩
> 1편 / [2편](https://m.blog.naver.com/premuto/224176688278) / 3편(이 글)

---

안녕하세요, 프리뮤토입니다.

2편에서 혈액검사 OCR과 매핑 시스템까지 이야기했는데, 그 사이에 일주일 동안 무슨 일이 있었냐면... PR 50개가 머지됐습니다. 저 혼자서요. 아니, 정확히는 저와 Claude가 둘이서요.

이번 편에서는 지난 한 주(2/7~2/14) 동안 Claude Code와 함께 바이브 코딩으로 만들어낸 것들을 정리해 봅니다.

---

## 1. 사료량 계산기 & 급여 계획 시스템

이번 주 가장 큰 작업이었습니다.

미모가 먹는 사료가 두 종류인데, 매번 "이거 몇 그램이지?" 하면서 계산기를 두드리고 있었거든요. 그래서 만들었습니다.

### 사료량 계산기 (/calorie-calculator)

체중과 활동량을 입력하면 일일 권장 칼로리(RER)를 계산하고, 등록된 사료의 칼로리 밀도에 따라 "하루에 몇 그램 줘야 하는지" 바로 알려줍니다.

- RER(안정 시 에너지 요구량) = 70 x 체중^0.75
- 활동 계수(중성화 여부, 나이, 활동량)를 곱해서 DER 산출
- 사료의 kcal/g 또는 kcal/100g에 따라 급여량 환산

### 다중 사료 믹싱

핵심은 이겁니다. 사료 한 종류만 먹이는 집은 별로 없잖아요.

최대 5개 사료를 비율로 섞어서 급여 계획을 짤 수 있게 했습니다. 예를 들어:
- 힐스 k/d 60%
- 로얄캐닌 리날 40%

이렇게 설정하면 각 사료별 급여량(g)이 자동 계산됩니다.

### Carry-Forward

급여 계획을 날짜별로 저장하는데, 매일 새로 입력할 필요 없이 직전 계획이 자동으로 이어집니다. 사료 바꿀 때만 새로 저장하면 되는 거죠.

### 일일 기록 연동

일일 기록 페이지의 칼로리 바가 이제 활성 급여 계획 기준으로 표시됩니다. "오늘 권장량 대비 몇 % 먹었는지"가 한눈에 보이는 거예요.

### 관리자 사료 DB

사료 정보(브랜드, 칼로리 밀도, 종류, 대상 동물)를 관리하는 어드민 페이지도 만들었습니다. 사용자들이 사료를 검색해서 바로 선택할 수 있도록요.

> Claude에게 "사료 여러 개 섞어서 급여량 계산하는 기능 만들어줘"라고 했더니, DB 테이블 설계부터 API, 프론트엔드 UI까지 한 세션에 뚝딱 나왔습니다. 물론 모바일에서 사료 선택 드롭다운이 안 눌리는 버그가 있어서... 이건 뒤에서 이야기하겠습니다.

---

## 2. 유실동물 전단지 시스템

이건 원래 계획에 없던 기능인데, 동네에서 강아지 잃어버렸다는 전단지를 보고 "우리 앱에 이거 넣으면 좋겠다" 싶어서 만들었습니다.

### 구현 내용

- 관리자가 전단지 이미지를 업로드하고 상태 관리(활성/종료)
- 공개 갤러리 페이지에서 누구나 전단지 확인 가능
- 앱 접속 시 하루 1회 랜덤 활성 전단지 팝업 (하루동안 보지않기 가능)
- ZIP 파일로 여러 전단지 한 번에 업로드

처음에는 텍스트 기반 공지사항으로 유실동물 정보를 올렸는데, 전단지는 역시 이미지가 훨씬 효과적이더라고요. 이미지 갤러리 + 라이트박스 + 팝업 시스템으로 완전히 새로 만들었습니다.

> 11개 파일, 951줄 추가. Claude한테 "유실동물 전단지 이미지 관리하고 팝업으로 보여주는 기능"이라고 설명했더니 관리자 CRUD, 공개 갤러리, 팝업 시스템까지 한 번에 구현해줬습니다.

---

## 3. 혈액검사 단위 정규화

이전 편에서 OCR로 혈액검사를 읽어오는 것까지 했는데, 문제가 하나 있었습니다. 병원마다 같은 검사항목이라도 단위가 다릅니다.

예를 들어 나트륨(Na):
- A병원: 152 mEq/L
- B병원: 152 mmol/L

나트륨은 1가 이온이라 mEq/L = mmol/L이니까 같은 값이지만, 크레아티닌 같은 건:
- A장비: 1.2 mg/dL
- B장비: 106.1 μmol/L

이러면 트렌드 그래프에서 갑자기 값이 100배 뛰어버립니다.

### 해결

15개 변환 규칙을 추가해서 그래프와 테이블에서 자동으로 표준 단위로 변환합니다.

- NH3, Lactate, CRP, SDMA, proBNP, Fibrinogen, D-dimer, Blood Gas 항목 등
- 원본값은 툴팁에서 확인 가능
- WBC 감별항목(호중구, 림프구 등) 8종 변환 규칙도 추가

### 단위 패턴 관리 UI

관리자가 단위 별칭과 보정 규칙을 직접 관리할 수 있는 페이지도 만들었습니다. 새로운 장비가 나와서 처음 보는 단위가 등장해도 대응 가능하도록요.

---

## 4. Sentry 에러 모니터링 도입

앱이 점점 커지면서 "어디서 에러가 나는지" 파악이 어려워졌습니다. 사용자가 "안 돼요"라고만 하면 재현이 안 되는 경우가 많거든요.

Sentry를 붙였습니다:
- Session Replay: 사용자가 에러를 만나기 직전에 뭘 했는지 영상으로 확인
- 로그 수집: console.warn, console.error 자동 수집
- 트레이스: API 호출 흐름 추적
- Error Boundary: 에러 발생 시 앱이 하얀 화면이 아니라 "문제가 발생했습니다" UI 표시

> 이것도 Claude에게 "Sentry 붙여줘"라고 했더니 client/server/edge config 전부 설정하고, layout.tsx에 trace 메타태그까지 넣어줬습니다. 단, `automaticVercelMonitors` 설정 위치 때문에 빌드가 두 번 깨졌고... webpack 안에 넣었다 뺐다 하면서 결국 해결.

---

## 5. 모바일 터치 이벤트와의 사투

이번 주 가장 고생한 부분입니다.

사료 선택 드롭다운을 만들었는데, PC에서는 잘 되는데 모바일에서 목록 항목을 탭해도 선택이 안 되는 겁니다.

### 원인

Radix UI의 Popover + cmdk(Command) 조합에서, Popover의 DismissableLayer가 document 레벨 capture phase에서 pointer event를 먼저 가로채버립니다. 모바일 터치 이벤트가 `onSelect` 콜백에 도달하기 전에 Popover가 닫혀버리는 레이스 컨디션이었어요.

### 삽질 과정

1. `onPointerDown`에서 `preventDefault` + 직접 선택 처리 → 부분적 해결
2. Radix Popover를 제거하고 단순 absolute 드롭다운으로 교체 → 동작은 하는데 코드가 복잡
3. 최종: 병원 선택에서 잘 되는 Radix Select 패턴으로 통일 → 해결

PR이 5개나 나왔습니다. (#230~#235) 같은 문제를 다른 방식으로 계속 시도한 거죠.

> 바이브 코딩의 현실: AI가 만든 코드가 PC에서는 완벽하게 동작하는데 모바일에서 안 되는 경우가 있습니다. 이런 건 직접 모바일로 테스트하면서 "이거 안 돼" → "이렇게 해볼까" → "그것도 안 돼" → "그러면 이건?"을 반복해야 합니다. AI가 모바일 디바이스를 실제로 만져볼 수는 없으니까요.

---

## 6. 그 외 개선들

### OCR 단위 추출 개선
프롬프트를 강화하고 가비지 감지를 추가해서, OCR이 읽어온 단위가 더 정확해졌습니다.

### 미분류항목 수동 매핑
OCR이 매칭하지 못한 검사항목을 관리자가 직접 표준항목에 매핑하는 UI를 개선했습니다.

### Google Drive 백업 개선
검사지 파일명이 유실되거나 중복되는 문제를 수정하고, 업로드 타이밍을 저장 시점으로 변경했습니다.

### 캘린더 날짜 버그
UTC/로컬 타임존 차이 때문에 날짜가 하루 밀리는 클래식한 버그도 잡았습니다.

### Blood Gas 마스터 데이터
GEM 장비에서 나오는 Blood Gas 항목 9개와 별칭 18개를 추가했습니다. 병원에서 GEM 3500으로 찍은 검사지도 이제 인식됩니다.

---

## 이번 주 숫자로 보기

| 항목 | 수치 |
|------|------|
| 머지된 PR | 50개 |
| 주요 신규 기능 | 5개 |
| 버그 수정 | 20건+ |
| 새로 생성된 파일 | 30개+ |
| 추가된 코드 | 5,000줄+ |

---

## 바이브 코딩 3주차, 느낀 점

### AI가 잘하는 것
- **새 기능의 초기 구현**: "이런 기능 만들어줘"라고 하면 DB 설계부터 API, 프론트엔드까지 한 번에 나옵니다. 사료량 계산기가 대표적.
- **반복 패턴 적용**: "다른 관리자 페이지랑 같은 패턴으로"라고 하면 기존 코드를 참조해서 일관성 있게 만들어줍니다.
- **에러 메시지 기반 디버깅**: 에러 로그를 붙여넣으면 원인 파악이 빠릅니다.

### AI가 못하는 것 (사람이 해야 하는 것)
- **모바일 실기기 테스트**: 터치 이벤트, 레이아웃 깨짐 같은 건 직접 확인해야 합니다.
- **도메인 판단**: "이 검사항목과 저 검사항목이 같은 건가?" 같은 수의학 지식 기반 결정.
- **우선순위 결정**: 50개 할 일 중에 뭘 먼저 할지는 결국 제가 정해야 합니다.
- **"이게 진짜 필요한가?"**: 유실동물 전단지 기능처럼, 사용자 입장에서의 필요를 느끼는 건 직접 경험에서 나옵니다.

### 실수에서 배운 것
- Vercel 배포 환경에서는 파일 시스템이 읽기 전용입니다. 로컬에서 잘 되던 config 파일 저장이 배포하면 터집니다. → DB 저장으로 전환
- RLS(Row Level Security) 정책이 SELECT만 있고 INSERT/UPDATE/DELETE가 없으면, 관리자도 데이터를 수정할 수 없습니다. → Service Role 클라이언트 사용

---

## 다음 편 예고

Pet Sharing(반려동물 공유) 기능을 준비하고 있습니다. 가족 구성원끼리 같은 반려동물의 건강 기록을 공유하는 기능이에요. 이것도 바이브 코딩으로 어디까지 갈 수 있는지 다음 편에서 이야기하겠습니다.

---

읽어주셔서 감사합니다.
미모 건강 관리 앱 만드는 이야기, 다음 편에서 계속됩니다.

#바이브코딩 #VibeCoding #클로드코드 #ClaudeCode #반려견건강관리 #펫앱개발 #AI코딩 #사료량계산기 #혈액검사 #프리뮤토
