# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

# Project: Premuto - Pet Health Log (ë°˜ë ¤ë™ë¬¼ ê±´ê°• ê¸°ë¡)

## 1. í”„ë¡œì íŠ¸ ëª©í‘œ

ë°˜ë ¤ë™ë¬¼ì˜ ê±´ê°•ì„ ì¢…í•©ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” **ë‹¤ì¤‘ ì‚¬ìš©ì ì• í”Œë¦¬ì¼€ì´ì…˜**.

> **ì¤‘ìš”**: ì´ ì•±ì€ ë‹¤ì¤‘ ì‚¬ìš©ìê°€ íšŒì›ê°€ì…í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ê° ì‚¬ìš©ìëŠ” ë³¸ì¸ì˜ ë°˜ë ¤ë™ë¬¼ ë°ì´í„°ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1-1. ì¼ì¼ ê±´ê°• ê¸°ë¡ (v3 ì‹ ê·œ)

- ì‹ì‚¬, ìŒìˆ˜, ì•½, ë°°ë³€, ë°°ë‡¨, í˜¸í¡ìˆ˜ë¥¼ ë¹ ë¥´ê²Œ ê¸°ë¡
- ë‚ ì§œë³„ íƒ€ì„ë¼ì¸ìœ¼ë¡œ ê¸°ë¡ í™•ì¸
- ì¼ì¼ í†µê³„ë¡œ ì„­ì·¨ëŸ‰, íšŸìˆ˜, í‰ê·  í˜¸í¡ìˆ˜ ì¶”ì 
- **v3.1 ì¶”ê°€**: ê¸°ë¡ ìˆ˜ì • ê¸°ëŠ¥ (ì–‘, ì•½ ì´ë¦„, ë©”ëª¨ ì¸ë¼ì¸ í¸ì§‘)
- **v3.1 ì¶”ê°€**: í´ë¦½ë³´ë“œ ë‚´ë³´ë‚´ê¸° (ì˜¤ëŠ˜ ìš”ì•½ + ìƒì„¸ ê¸°ë¡)
- **v3.2 ì¶”ê°€**: ìƒì„¸ Excel ë‚´ë³´ë‚´ê¸° (ìš”ì•½ + ê°œë³„ ê¸°ë¡, tier ì›”ê°„ ì œí•œ)
- **v3.2 ì¶”ê°€**: ì¹´í…Œê³ ë¦¬ í•„í„°ë§

### 1-2. í˜ˆì•¡ê²€ì‚¬ ì•„ì¹´ì´ë¸Œ

- ë‹¤ë…„ê°„ ëˆ„ì ëœ í˜ˆì•¡ê²€ì‚¬ì§€(PDF/ì´ë¯¸ì§€)ë¥¼ OCRë¡œ íŒë…í•˜ì—¬ DBí™”
- ë³‘ì›/ì¥ë¹„ë§ˆë‹¤ ë‹¤ë¥¸ ì°¸ê³ ì¹˜(Reference Range)ì™€ í•­ëª©ëª…(Alias)ì„ í‘œì¤€í™”
- ì‹œê³„ì—´ íŠ¸ë Œë“œ ë¶„ì„
- **v3.1 ì¶”ê°€**: OCR ê²°ê³¼ì—ì„œ ë‚ ì§œ/ë³‘ì› ìˆ˜ë™ ì„ íƒ ê¸°ëŠ¥
- **v3.1 ì¶”ê°€**: ê²€ì‚¬ ê¸°ë¡ ë³‘í•© ê¸°ëŠ¥ (ì¤‘ë³µ ê¸°ë¡ í†µí•©)

**v3.2 í•µì‹¬ ê°œì„ ì‚¬í•­**:

- ê²€ì‚¬í•­ëª© ë§ˆìŠ¤í„° ë°ì´í„° v4.3 (129ê°œ í‘œì¤€í•­ëª©, 107ê°œ ë³„ì¹­, description ì™„ë¹„)
- ë§¤í•‘ ë¡œì§ ê°œì„ : Step 0 ê°€ë¹„ì§€ í•„í„° ì¶”ê°€, fuzzy ì œê±° â†’ Step 0~3 (ê°€ë¹„ì§€í•„í„° â†’ exact â†’ alias â†’ AI)
- ëŒ€ì‹œë³´ë“œ View ì˜µì…˜ (ê²€ì‚¬ìœ í˜•ë³„/ì¥ê¸°ë³„/ì„ìƒìš°ì„ ìˆœìœ„ë³„/íŒ¨ë„ë³„ ì •ë ¬)
- í‘œì¤€í•­ëª© ê´€ë¦¬ í˜ì´ì§€ (/standard-items)
- item_aliases í…Œì´ë¸” (ì¥ë¹„ë³„ source_hint ì§€ì›)
- AI ì„¤ëª… ìë™ ìƒì„± (`description_common`/`high`/`low`, tier ì œí•œ)
- í‹°ì–´ ì‹œìŠ¤í…œ (Free/Basic/Premium, ì‚¬ìš©ëŸ‰ ì œí•œ)
- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ë° ì„¤ì • í˜ì´ì§€ 6ì¢…

> ğŸ“˜ **ìƒì„¸ ë¬¸ì„œ**: [docs/tier-system.md](docs/tier-system.md) â€” í‹°ì–´ë³„ ì œí•œ, ì‚¬ìš©ëŸ‰ ì¶”ì 
> ğŸ“˜ **ìƒì„¸ ë¬¸ì„œ**: [docs/admin-features.md](docs/admin-features.md) â€” ê´€ë¦¬ì ê¸°ëŠ¥ ëª…ì„¸

**v3.1 í•µì‹¬ ê°œì„ ì‚¬í•­**:

- ì¼ì¼ ê¸°ë¡ í´ë¦½ë³´ë“œ ë‚´ë³´ë‚´ê¸° (ì˜¤ëŠ˜ ìš”ì•½ + ìƒì„¸ ê¸°ë¡ í¬ë§·)
- ì¼ì¼ ê¸°ë¡ ì¸ë¼ì¸ ìˆ˜ì • ê¸°ëŠ¥ (ì–‘, ì•½ ì´ë¦„, ë©”ëª¨)
- ìº˜ë¦°ë” UIë¡œ ë‚ ì§œ ì„ íƒ (í•œêµ­ì–´ ìš”ì¼, ì˜¤ëŠ˜ ì´ë™ ë²„íŠ¼)
- OCR ê²°ê³¼ì—ì„œ ë‚ ì§œ/ë³‘ì› ìˆ˜ë™ ì„ íƒ ë° ìˆ˜ì •
- ê²€ì‚¬ ê¸°ë¡ ë³‘í•© ê¸°ëŠ¥ (ì¶©ëŒ ê°ì§€ ë° í•´ê²° UI)

**v3 í•µì‹¬ ê°œì„ ì‚¬í•­**:

- ì¼ì¼ ê±´ê°• ê¸°ë¡ ì„œë¹„ìŠ¤ ì¶”ê°€ (ë©”ì¸ í˜ì´ì§€)
- OCR ì—”ì§„ Claude APIë¡œ ë³€ê²½ (PDF êµ¬ì¡° ì´í•´ í–¥ìƒ)
- í–„ë²„ê±° ë©”ë‰´ë¡œ ì„œë¹„ìŠ¤ ê°„ ì´ë™

**v2 í•µì‹¬ ê°œì„ ì‚¬í•­**:

- ì—¬ëŸ¬ ë‚ ì§œì˜ ê²€ì‚¬ë¥¼ í•œ ë²ˆì— ì—…ë¡œë“œí•˜ê³  ìë™ìœ¼ë¡œ ë‚ ì§œë³„ ê·¸ë£¹í™”
- ë‚ ì§œë³„ íƒ­ UIë¡œ ê° ê²€ì‚¬ë¥¼ ë…ë¦½ì ìœ¼ë¡œ í™•ì¸ ë° ì €ì¥
- GPT-4o ê¸°ë°˜ ì§€ëŠ¥í˜• ë§¤ì¹­ìœ¼ë¡œ ì‚¬ìš©ì ê°œì… ìµœì†Œí™”
- ê²°ê³¼ ìš°ì„  í™•ì¸ ë°©ì‹ìœ¼ë¡œ ë¹ ë¥¸ í”¼ë“œë°± ì œê³µ
- ë³‘ë ¬ ì²˜ë¦¬ (OCR, AI ë§¤ì¹­, ì €ì¥)ë¡œ ì„±ëŠ¥ ê·¹ëŒ€í™”

## 2. í”„ë¡œì íŠ¸ ë¬¸ì„œ êµ¬ì¡°

ì´ í”„ë¡œì íŠ¸ëŠ” ë‹¤ìŒ ë¬¸ì„œë“¤ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

### í•µì‹¬ ë¬¸ì„œ

- **CLAUDE.md** (ì´ íŒŒì¼): ê°œë°œ ê°€ì´ë“œë¼ì¸ ë° í”„ë¡œì íŠ¸ íŠ¹í™” ê·œì¹™
- **PRD.md**: ì œí’ˆ ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ - ì‚¬ìš©ì ì›Œí¬í”Œë¡œìš°ì™€ UI ìš”êµ¬ì‚¬í•­
- **SCHEMA.md**: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ - 7ê°œ í•µì‹¬ í…Œì´ë¸”
- **README.md**: í”„ë¡œì íŠ¸ ê°œìš” ë° Claude Code ì„¤ì • ê°€ì´ë“œ

### ê²€ì‚¬í•­ëª© ë°ì´í„° (docs/)

- **docs/standard_items_master.json**: ë§ˆìŠ¤í„° ë°ì´í„° â€” ì •ê·œí•­ëª© 129ê°œ + alias 107ê°œ + ì •ë ¬ì²´ê³„ 4ì¢…
- **docs/mapping_logic.md**: ë§¤í•‘ ë¡œì§ â€” Step 0~3 í”Œë¡œìš°, AI í”„ë¡¬í”„íŠ¸, Unmapped ì²˜ë¦¬, ê¸°ë¡ ì €ì¥ êµ¬ì¡°

### ìš´ì˜ ë¬¸ì„œ (docs/)

- **docs/tier-system.md**: í‹°ì–´ ì‹œìŠ¤í…œ â€” Free/Basic/Premium ì œí•œê°’, ì‚¬ìš©ëŸ‰ ì¶”ì , `lib/tier.ts`
- **docs/admin-features.md**: ê´€ë¦¬ì ê¸°ëŠ¥ â€” 6ê°œ ê´€ë¦¬ í˜ì´ì§€ ëª…ì„¸

### ì¬ì‚¬ìš© ê°€ëŠ¥í•œ Skills (.claude/skills/)

ë²”ìš©ì ìœ¼ë¡œ í™œìš© ê°€ëŠ¥í•œ ì„¤ê³„ íŒ¨í„´ë“¤:

| Skill                                                                           | ì„¤ëª…                               | ì´ í”„ë¡œì íŠ¸ ì ìš©         |
| ------------------------------------------------------------------------------- | ---------------------------------- | ------------------------ |
| [reference-snapshot-pattern.md](.claude/skills/reference-snapshot-pattern.md)   | ì‹œê³„ì—´ ë°ì´í„°ì˜ ê¸°ì¤€ê°’ ìŠ¤ëƒ…ìƒ· ì €ì¥ | í˜ˆì•¡ê²€ì‚¬ ì°¸ê³ ì¹˜          |
| [confidence-based-ux.md](.claude/skills/confidence-based-ux.md)                 | AI ì‹ ë¢°ë„ ê¸°ë°˜ ì‚¬ìš©ì ê°œì… UX      | OCR â†’ í‘œì¤€í•­ëª© ë§¤í•‘ ê²€ìˆ˜ |
| [hybrid-mapping-logic.md](.claude/skills/hybrid-mapping-logic.md)               | Në‹¨ê³„ í•˜ì´ë¸Œë¦¬ë“œ ë§¤í•‘ ë¡œì§         | ê²€ì‚¬í•­ëª© í‘œì¤€í™”          |
| [multi-user-rls-isolation.md](.claude/skills/multi-user-rls-isolation.md)       | Supabase RLS ê¸°ë°˜ ì‚¬ìš©ì ê²©ë¦¬      | ë‹¤ì¤‘ ì‚¬ìš©ì ë°ì´í„° ë³´í˜¸  |
| [multi-file-batch-processing.md](.claude/skills/multi-file-batch-processing.md) | ë‹¤ì¤‘ íŒŒì¼ ë°°ì¹˜ ì²˜ë¦¬ íŒ¨í„´           | ê²€ì‚¬ì§€ ì¼ê´„ ì—…ë¡œë“œ       |
| [daily-log-timeline.md](.claude/skills/daily-log-timeline.md)                   | ì¼ì¼ ê¸°ë¡ íƒ€ì„ë¼ì¸ íŒ¨í„´            | ì¼ì¼ ê±´ê°• ê¸°ë¡           |

## 3. ì•„í‚¤í…ì²˜ ê°œìš”

### ì¼ì¼ ê±´ê°• ê¸°ë¡ íë¦„ (Daily Log Flow)

> ğŸ“˜ **íŒ¨í„´ ì°¸ì¡°**: [daily-log-timeline.md](.claude/skills/daily-log-timeline.md)

**Premuto íŠ¹í™” ì¹´í…Œê³ ë¦¬**:
| ì¹´í…Œê³ ë¦¬ | ì•„ì´ì½˜ | ë‹¨ìœ„ | ì…ë ¥ ë°©ì‹ |
|---------|--------|------|----------|
| meal (ì‹ì‚¬) | ğŸš | g | ì–‘ ì…ë ¥ |
| water (ìŒìˆ˜) | ğŸ’§ | ml | ì–‘ ì…ë ¥ |
| medicine (ì•½) | ğŸ’Š | ì • | ì–‘ + ì•½ ì´ë¦„ |
| poop (ë°°ë³€) | ğŸ’© | íšŒ | ì›í„°ì¹˜ |
| pee (ë°°ë‡¨) | ğŸš½ | íšŒ | ì›í„°ì¹˜ |
| breathing (í˜¸í¡ìˆ˜) | ğŸ« | íšŒ/ë¶„ | ë¶„ë‹¹ í˜¸í¡ìˆ˜ |

**API ì—”ë“œí¬ì¸íŠ¸**: `/api/daily-logs`

- GET: ë‚ ì§œë³„ ê¸°ë¡ ì¡°íšŒ, í†µê³„ ì¡°íšŒ (`?stats=true`)
- POST: ìƒˆ ê¸°ë¡ ì¶”ê°€
- PATCH: ê¸°ë¡ ìˆ˜ì •
- DELETE: ê¸°ë¡ ì‚­ì œ

---

### í˜ˆì•¡ê²€ì‚¬ ë°ì´í„° íë¦„ (Data Flow)

> ğŸ“˜ **íŒ¨í„´ ì°¸ì¡°**:
>
> - [multi-file-batch-processing.md](.claude/skills/multi-file-batch-processing.md) - ë‹¤ì¤‘ íŒŒì¼ ì²˜ë¦¬
> - [hybrid-mapping-logic.md](.claude/skills/hybrid-mapping-logic.md) - í•­ëª© ë§¤í•‘
> - [confidence-based-ux.md](.claude/skills/confidence-based-ux.md) - ê²€ìˆ˜ UX

#### Phase 1-2: ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œ ë° OCR

- ìµœëŒ€ 10ê°œ íŒŒì¼ ë™ì‹œ ì—…ë¡œë“œ
- ë³‘ë ¬ OCR ì²˜ë¦¬ (Claude API)
- ë‚ ì§œ+ë³‘ì› ê¸°ì¤€ ìë™ ê·¸ë£¹í™”
- OCR ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° (Preview Before Mapping)

#### Phase 3-4: ë§¤í•‘ ë° ê²€ìˆ˜

- Step 0: ê°€ë¹„ì§€ í•„í„°ë§ (OCR ì“°ë ˆê¸° ìë™ ì œê±°)
- Step 1~2: ì •ê·œí•­ëª©/Alias exact match (ìë™)
- Step 3: AI íŒë‹¨ â†’ match(alias ìë™ ë“±ë¡) ë˜ëŠ” new(ì‹ ê·œ í•­ëª©)
- ì‹ ë¢°ë„ ê¸°ë°˜ ê²€ìˆ˜ UI (ğŸŸ¢â‰¥90% ğŸŸ¡70-89% ğŸ”´<70%)
- í•™ìŠµ í”¼ë“œë°± ë£¨í”„ (ìŠ¹ì¸/ìˆ˜ì • â†’ item_aliases ì €ì¥)

#### Phase 5-6: ì €ì¥ ë° ì‹œê°í™”

- ë‚ ì§œ ê·¸ë£¹ë³„ ë…ë¦½ íŠ¸ëœì­ì…˜
- í”¼ë²— í…Œì´ë¸” + ì‹œê³„ì—´ ê·¸ë˜í”„

## 4. í•µì‹¬ ë„ë©”ì¸ ê·œì¹™ (Business Rules)

### A. ë°ì´í„° ë§¤í•‘ ë° í‘œì¤€í™”

> ğŸ“˜ **ìƒì„¸ ë¬¸ì„œ**: `docs/mapping_logic.md` â€” ì „ì²´ ë§¤í•‘ í”Œë¡œìš°, AI í”„ë¡¬í”„íŠ¸, Unmapped ì²˜ë¦¬
> ğŸ“˜ **ë§ˆìŠ¤í„° ë°ì´í„°**: `docs/standard_items_master.json` â€” ì •ê·œí•­ëª© 129ê°œ + alias 107ê°œ + ì •ë ¬ì²´ê³„ 4ì¢…

**ê²€ì‚¬í•­ëª© ë§ˆìŠ¤í„° v4.3 (129ê°œ ì •ê·œí•­ëª©, 107ê°œ alias = 236ê°œ ì´ë¦„ ì¸ì‹)**

ë³‘ì›/ì¥ë¹„ë§ˆë‹¤ ê°™ì€ ê²€ì‚¬ë¥¼ ë‹¤ë¥´ê²Œ í‘œê¸°í•˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°:

- ì¥ë¹„ëª… ë¶€ì°© (HCT vs Hct(ABL80F)), ì•½ì–´ ì°¨ì´ (ALKP vs ALP), ì´ì˜¨ í‘œê¸° (K+ vs Potassium)
- íŒë‹¨ ê¸°ì¤€: â‘ ì¸¡ì • ëŒ€ìƒ ë™ì¼? â‘¡ë‹¨ìœ„ í˜¸í™˜? â‘¢ê°™ì€ íŠ¸ë Œë“œ? â†’ 3ê°œ ëª¨ë‘ Yesë©´ í•©ì¹¨

**ë§¤í•‘ Step 0~3**: 0. **ê°€ë¹„ì§€ í•„í„°** â€” OCR ì“°ë ˆê¸° ë²„ë¦¼ ("< 0.25", "ê¸°íƒ€", ë‹¨ìœ„ ì˜ë¦¼ ë³´ì •)

1. **ì •ê·œ í•­ëª© Exact Match** (100%) â€” `standard_items.name` case-insensitive
2. **Alias Exact Match** (95%) â€” `item_aliases.alias` + `source_hint` ê¸°ë¡
3. **AI íŒë‹¨** â€” Claude API. match â†’ alias ìë™ ë“±ë¡ / new â†’ ì‹ ê·œ í•­ëª© ìƒì„±
   - confidence < 0.7 â†’ Unmappedë¡œ ì €ì¥, ì‚¬ìš©ìê°€ ë§¤í•‘ ë©”ë‰´ì—ì„œ ì²˜ë¦¬

**ì‚¬ìš© ì»¨í…ìŠ¤íŠ¸**:

- OCR ì§í›„: Step 0â†’1â†’2â†’3 ìë™ ì‹¤í–‰, ì‚¬ìš©ì ê°œì… ì—†ìŒ
- Unmapped ì •ë¦¬: ë§¤í•‘ ë©”ë‰´ì—ì„œ ìˆ˜ë™ ë§¤í•‘/ì‹ ê·œë“±ë¡/ì‚­ì œ

**ì‹ ë¢°ë„ ê¸°ë°˜ UX**: [confidence-based-ux.md](.claude/skills/confidence-based-ux.md) ì°¸ì¡°

---

### B. ì°¸ê³ ì¹˜ ìŠ¤ëƒ…ìƒ· ê·œì¹™

> ğŸ“˜ **íŒ¨í„´ ì°¸ì¡°**: [reference-snapshot-pattern.md](.claude/skills/reference-snapshot-pattern.md)

**Premuto íŠ¹í™” ì ìš©**:

- `test_results` í…Œì´ë¸”ì˜ ê° ë ˆì½”ë“œëŠ” `ref_min`, `ref_max`, `ref_text` ë³´ìœ 
- ì¥ë¹„ë³„ ì°¸ê³ ì¹˜ ì°¨ì´ ì˜ˆì‹œ:
  - Hitachi: Creatinine 0~10
  - IDEXX: Creatinine 0~<9
  - Fuji: Creatinine 0.5~1.8
- UIì—ì„œ ì°¸ê³ ì¹˜ ë³€ê²½ ì‹œ âš ï¸ ì•„ì´ì½˜ í‘œì‹œ

**íŒì • ë¡œì§**:

- ğŸ”´ High: Value > Ref_Max
- ğŸ”µ Low: Value < Ref_Min
- ğŸŸ¢ Normal: Ref_Min â‰¤ Value â‰¤ Ref_Max
- (ì—†ìŒ): ì°¸ê³ ì¹˜ ì—†ëŠ” ê²½ìš°

---

### C. ë‹¤ì¤‘ íŒŒì¼ ì²˜ë¦¬ ê·œì¹™

> ğŸ“˜ **íŒ¨í„´ ì°¸ì¡°**: [multi-file-batch-processing.md](.claude/skills/multi-file-batch-processing.md)

**Premuto ê·¸ë£¹í™” ê¸°ì¤€**: `ê²€ì‚¬ ë‚ ì§œ` + `ë³‘ì›ëª…`

- íƒ­ ì œëª©: `2025-12-08 (ë³‘ì›ëª…)` ë˜ëŠ” `(2)` ìˆœë²ˆ
- ì¤‘ë³µ í•­ëª©: ê°’ ë™ì¼ â†’ ìë™ ë³‘í•©, ê°’ ë‹¤ë¦„ â†’ ì‚¬ìš©ì ì„ íƒ
- íŒŒì¼ ì¶”ì : `test_results.source_filename`

---

### D. ê²€ì‚¬ ê¸°ë¡ ë³‘í•© ê·œì¹™ (v3.1)

**ì¶©ëŒ ìœ í˜•**:

- ë‚ ì§œ ì¶©ëŒ â†’ ì‚¬ìš©ìê°€ ìµœì¢… ë‚ ì§œ ì„ íƒ
- ë³‘ì› ì¶©ëŒ â†’ ì‚¬ìš©ìê°€ ìµœì¢… ë³‘ì› ì„ íƒ
- í•­ëª© ê°’ ì¶©ëŒ â†’ ì‚¬ìš©ìê°€ ìœ ì§€í•  ê°’ ì„ íƒ

**API**: `GET/POST /api/test-results/merge`

---

### E. ë¯¸ëª¨ ì£¼ìš” ê´€ë¦¬ í•­ëª© (Priority Items)

UIì—ì„œ ê°•ì¡° í‘œì‹œí•  í•­ëª©:

- **ì·Œì¥**: `Lipase`, `cPL` (ê·¸ë˜í”„ ì‹œê°í™” í•„ìˆ˜)
- **ì‹ ì¥**: `BUN`, `Creatinine`, `SDMA`, `Phosphorus`
- **ê°„**: `ALT`, `ALKP`, `GGT`
- **CBC**: `HCT`, `PLT`

## 5. ê¸°ìˆ  ìŠ¤íƒ

- **Frontend**: Next.js 14, Tailwind CSS, Shadcn/ui
  - react-dropzone (ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œ)
  - date-fns (ë‚ ì§œ ì²˜ë¦¬)
  - Pretendard (í•œêµ­ì–´ ì›¹ í°íŠ¸)
- **Backend/DB**: Supabase (PostgreSQL)
  - RLS ê¸°ë°˜ ì‚¬ìš©ì ê²©ë¦¬
- **Auth**: Supabase Auth (ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ + Kakao OAuth)
- **AI/OCR**: Claude API, GPT-4o
- **Tier ê´€ë¦¬**: `lib/tier.ts`, `usage_logs` í…Œì´ë¸” ê¸°ë°˜ ì‚¬ìš©ëŸ‰ ì¶”ì 

### Context êµ¬ì¡° ë° Provider ê³„ì¸µ

ì•± ì „ì—­ ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•œ Context Provider êµ¬ì¡°:

```
<AuthProvider>           # ì¸ì¦ ë° ê´€ë¦¬ì ìƒíƒœ
  <PetProvider>          # ë°˜ë ¤ë™ë¬¼ ëª©ë¡ ë° í˜„ì¬ ì„ íƒ
    <RequirePetGuard>    # ë°˜ë ¤ë™ë¬¼ í•„ìˆ˜ ë“±ë¡ ê°€ë“œ
      {children}
    </RequirePetGuard>
  </PetProvider>
</AuthProvider>
```

| Context           | íŒŒì¼                             | ì—­í•                                                                                |
| ----------------- | -------------------------------- | ---------------------------------------------------------------------------------- |
| `AuthContext`     | `contexts/AuthContext.tsx`       | ê´€ë¦¬ì ìƒíƒœ (`isAdmin`) ì „ì—­ ê´€ë¦¬. ì•± ì´ˆê¸°í™” ì‹œ 1íšŒë§Œ `/api/auth/check-admin` í˜¸ì¶œ |
| `PetContext`      | `contexts/PetContext.tsx`        | ë°˜ë ¤ë™ë¬¼ ëª©ë¡, í˜„ì¬ ì„ íƒëœ pet, localStorage ë™ê¸°í™”                                |
| `RequirePetGuard` | `components/RequirePetGuard.tsx` | ë°˜ë ¤ë™ë¬¼ ë¯¸ë“±ë¡ ì‹œ ë“±ë¡ ëª¨ë‹¬ í‘œì‹œ                                                  |

**ì£¼ì˜**: `RequirePetGuard`ëŠ” `initialLoadDone` í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ˆê¸° ë¡œë”© ì‹œì—ë§Œ ìŠ¤í”¼ë„ˆë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
ì´í›„ auth ìƒíƒœ ë³€ê²½ìœ¼ë¡œ ì¸í•œ re-fetch ì‹œì—ëŠ” childrenì„ ì–¸ë§ˆìš´íŠ¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
(ëª¨ë‹¬ ë‚´ íŒŒì¼ ì„ íƒ ë“±ì˜ ìƒí˜¸ì‘ìš© ì¤‘ë‹¨ ë°©ì§€)

## 6. ì½”ë”© ì»¨ë²¤ì…˜

### ìƒíƒœ íŒì • ì‹œê°í™”

- ğŸ”´ High (ìˆ˜ì¹˜ > Max)
- ğŸ”µ Low (ìˆ˜ì¹˜ < Min)
- ğŸŸ¢ Normal (Min â‰¤ ìˆ˜ì¹˜ â‰¤ Max)

### ì‹ ë¢°ë„ ë°°ì§€

> ğŸ“˜ **íŒ¨í„´ ì°¸ì¡°**: [confidence-based-ux.md](.claude/skills/confidence-based-ux.md)

- ğŸŸ¢ â‰¥90%: "ë†’ìŒ" (ë…¹ìƒ‰)
- ğŸŸ¡ 70-89%: "ë³´í†µ" (ë…¸ë€ìƒ‰)
- ğŸ”´ <70%: "ë‚®ìŒ" (ë¹¨ê°„ìƒ‰)

### ë§¤ì¹­ ì†ŒìŠ¤ ì•„ì´ì½˜

- ğŸ¤– AI ìë™ ë§¤í•‘
- âœ“ ì‚¬ìš©ì ìŠ¹ì¸
- âœï¸ ì‚¬ìš©ì ìˆ˜ë™ ì…ë ¥

## 7. API ì—”ë“œí¬ì¸íŠ¸ ëª…ì„¸

### ì¼ì¼ ê¸°ë¡

- `GET/POST/PATCH/DELETE /api/daily-logs`
- `POST /api/daily-logs/upload` - ì‚¬ì§„ ì—…ë¡œë“œ
- `POST /api/daily-logs/export-detailed` - ìƒì„¸ Excel ë‚´ë³´ë‚´ê¸° (tier ì›”ê°„ ì œí•œ)

### í˜ˆì•¡ê²€ì‚¬

- `POST /api/ocr-batch` - ë‹¤ì¤‘ íŒŒì¼ OCR
- `POST /api/ai-mapping` - AI ë§¤í•‘
- `POST /api/test-results-batch` - ì¼ê´„ ì €ì¥
- `GET/POST /api/test-results/merge` - ê¸°ë¡ ë³‘í•©
- `GET /api/export-excel` - ê²€ì‚¬ ê²°ê³¼ Excel ë‚´ë³´ë‚´ê¸°

### AI ê¸°ëŠ¥

- `POST /api/generate-descriptions` - í‘œì¤€í•­ëª© AI ì„¤ëª… ìƒì„± (tier ì¼ì¼ ì œí•œ)

### Tier ë° ì‚¬ìš©ì

- `GET /api/tier` - ì‚¬ìš©ì í‹°ì–´ ë° ì‚¬ìš©ëŸ‰ ì¡°íšŒ
- `POST /api/user/reset-master-data` - ì»¤ìŠ¤í…€ ë°ì´í„° ì´ˆê¸°í™”
- `POST /api/auth/change-password` - ë¹„ë°€ë²ˆí˜¸ ë³€ê²½

### ê´€ë¦¬ì (Admin)

- `GET/POST /api/admin/sync-master-data` - ë§ˆìŠ¤í„° ë°ì´í„° ë™ê¸°í™”
- `GET/POST/DELETE /api/admin/item-aliases` - ë³„ì¹­ ê´€ë¦¬
- `GET/POST /api/admin/standard-items` - í‘œì¤€ í•­ëª© ê´€ë¦¬
- `PATCH /api/admin/standard-items/[id]` - í‘œì¤€ í•­ëª© ìˆ˜ì •
- `GET/PUT /api/admin/tier-config` - í‹°ì–´ ì„¤ì • ê´€ë¦¬
- `GET/POST /api/admin/users` - ì‚¬ìš©ì ê´€ë¦¬
- `GET/PUT /api/admin/site-settings` - ì‚¬ì´íŠ¸ ì„¤ì •
- `GET/PUT /api/admin/ocr-settings` - OCR ì„¤ì •
- `GET /api/admin/stats` - ê´€ë¦¬ì í†µê³„

## 8. ê°œë°œ ëª…ë ¹ì–´

```bash
npm run dev          # ê°œë°œ ì„œë²„
npm run build        # í”„ë¡œë•ì…˜ ë¹Œë“œ
npm run lint         # ESLint
npx supabase db push # DB ë§ˆì´ê·¸ë ˆì´ì…˜
```

### ë¡œì»¬ ë„êµ¬ ê²½ë¡œ

- **gh CLI**: `"C:/Program Files/GitHub CLI/gh.exe"` (PATHì— ì—†ìœ¼ë¯€ë¡œ ì „ì²´ ê²½ë¡œ ì‚¬ìš©)

## 9. ë³´ì•ˆ ì •ì±…

> ğŸ“˜ **íŒ¨í„´ ì°¸ì¡°**: [multi-user-rls-isolation.md](.claude/skills/multi-user-rls-isolation.md)

### Premuto ì ìš©

- ëª¨ë“  í…Œì´ë¸”ì— `user_id` ì»¬ëŸ¼ + RLS ì •ì±…
- ìŠ¤í† ë¦¬ì§€: `uploads/{user_id}/` í´ë” ê²©ë¦¬
- Signed URL: 7ì¼ ìœ íš¨, API ì‘ë‹µ ì‹œ ë™ì  ìƒì„±

**êµ¬í˜„ ìœ„ì¹˜**:

- `app/api/daily-logs/upload/route.ts`: íŒŒì¼ ê²½ë¡œë§Œ ì €ì¥
- `app/api/daily-logs/route.ts`: GET ì‹œ Signed URL ë³€í™˜

## 10. Git ì›Œí¬í”Œë¡œìš°

### Branch Naming

- ê¸°ëŠ¥ ê°œë°œ: `feat/ê¸°ëŠ¥ëª…` (ì˜ˆ: `feat/user-auth`)
- ë²„ê·¸ ìˆ˜ì •: `fix/ì´ìŠˆë²ˆí˜¸-ì„¤ëª…` (ì˜ˆ: `fix/123-login-error`)

### ì‘ì—… ìˆœì„œ (ë°˜ë“œì‹œ ì¤€ìˆ˜)

```
1. main ìµœì‹ í™”        git checkout main && git pull
2. ìƒˆ ë¸Œëœì¹˜ ìƒì„±      git checkout -b feat/ê¸°ëŠ¥ëª…
3. ì½”ë“œ ì‘ì—…           (íŒŒì¼ ìˆ˜ì •)
4. ì»¤ë°‹               git add <íŒŒì¼ë“¤> && git commit -m "..."
5. í‘¸ì‹œ               git push -u origin feat/ê¸°ëŠ¥ëª…
6. PR ìƒì„±            gh pr create ...
7. ë¨¸ì§€               gh pr merge ... --squash --delete-branch
8. main ë³µê·€          git checkout main && git pull
```

- **âš ï¸ ì ˆëŒ€ ê·œì¹™: ì–´ë–¤ ì½”ë“œ ìˆ˜ì •ì´ë“  ë°˜ë“œì‹œ ë¸Œëœì¹˜ë¥¼ ë¨¼ì € ìƒì„±í•œ í›„ ì§„í–‰**í•  ê²ƒ. ì´ ê·œì¹™ì€ ì˜ˆì™¸ ì—†ì´ ì ìš©ëœë‹¤.
  - ë°±ê·¸ë¼ìš´ë“œ ì—ì´ì „íŠ¸(Task tool)ì—ê²Œ ì‘ì—…ì„ ìœ„ì„í•  ë•Œë„ ë¸Œëœì¹˜ ìƒì„±ì„ ë¨¼ì € ì§€ì‹œí•  ê²ƒ
  - ë‹¨ í•œ ì¤„ì˜ ìˆ˜ì •ì´ë¼ë„ mainì—ì„œ ì§ì ‘ íŒŒì¼ì„ ìˆ˜ì •í•˜ì§€ ì•ŠëŠ”ë‹¤
  - ë¸Œëœì¹˜ ìƒì„± ì „ì— íŒŒì¼ì„ ìˆ˜ì •í•˜ëŠ” ê²ƒì€ ê¸ˆì§€ â€” ë°˜ë“œì‹œ `git checkout -b` í›„ í¸ì§‘
- **í•­ìƒ mainì—ì„œ ìƒˆ ë¸Œëœì¹˜ë¥¼ ìƒì„±**í•  ê²ƒ. ë‹¤ë¥¸ ë¸Œëœì¹˜ì—ì„œ ë¶„ê¸°í•˜ì§€ ì•ŠëŠ”ë‹¤.
- **ì–´ë–¤ ì‘ì—…ì´ë“  ë°˜ë“œì‹œ PRì„ ìƒì„±**í•  ê²ƒ. mainì— ì§ì ‘ ì»¤ë°‹/í‘¸ì‹œí•˜ì§€ ì•ŠëŠ”ë‹¤. (docs, fix, feat ëª¨ë‘ í¬í•¨)
- ë¨¸ì§€ ì‹œ `--squash`ë¡œ ì»¤ë°‹ì„ ì •ë¦¬í•˜ê³  `--delete-branch`ë¡œ ì›ê²© ë¸Œëœì¹˜ë¥¼ ì‚­ì œí•œë‹¤.

### ì—¬ëŸ¬ ê¸°ëŠ¥ ë™ì‹œ ì‘ì—…

```bash
# ê¸°ëŠ¥1 ì‘ì—… ì¤‘ â†’ ê¸°ëŠ¥2ë¥¼ ì‹œì‘í•´ì•¼ í•  ë•Œ
git stash                          # í˜„ì¬ ì‘ì—… ì„ì‹œ ë³´ê´€
git checkout main && git pull      # main ìµœì‹ í™”
git checkout -b feat/ê¸°ëŠ¥2          # ìƒˆ ë¸Œëœì¹˜ ìƒì„±
# ... ê¸°ëŠ¥2 ì‘ì—… ...

# ë‹¤ì‹œ ê¸°ëŠ¥1ë¡œ ëŒì•„ì˜¬ ë•Œ
git checkout feat/ê¸°ëŠ¥1
git stash pop                      # ì„ì‹œ ë³´ê´€í•œ ì‘ì—… ë³µì›
```

- ê° ë¸Œëœì¹˜ëŠ” ë…ë¦½ì ì´ë¯€ë¡œ ì—¬ëŸ¬ ê°œ ë™ì‹œ ì§„í–‰ ê°€ëŠ¥
- `git stash`ë¡œ ë¯¸ì™„ì„± ì‘ì—…ì„ ì„ì‹œ ë³´ê´€ í›„ ë¸Œëœì¹˜ ì „í™˜
- ì „í™˜ í›„ `git stash pop`ìœ¼ë¡œ ë³µì›
